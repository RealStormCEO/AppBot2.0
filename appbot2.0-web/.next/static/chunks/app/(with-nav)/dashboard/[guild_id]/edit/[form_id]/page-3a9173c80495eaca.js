(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[406],{22234:function(e,t,n){Promise.resolve().then(n.bind(n,9966))},9966:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(57437),s=n(47907),o=n(2265),r=n(2111);function i(e){let{children:t,...n}=e,[s,i]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{let e=requestAnimationFrame(()=>i(!0));return()=>cancelAnimationFrame(e)},[]),s)?(0,a.jsx)(r.bK,{...n,children:t}):null}var l=n(2404),c=n.n(l);function d(){let{guild_id:e,form_id:t}=(0,s.useParams)(),[n,l]=(0,o.useState)([]),[d,u]=(0,o.useState)([]),[m,h]=(0,o.useState)(!0),[p,_]=(0,o.useState)(!1),[j,x]=(0,o.useState)(""),[f,v]=(0,o.useState)("short"),[N,E]=(0,o.useState)(""),[g,y]=(0,o.useState)(null),[C,F]=(0,o.useState)(""),[S,b]=(0,o.useState)(""),[w,k]=(0,o.useState)(""),[q,B]=(0,o.useState)(null),[D,A]=(0,o.useState)(!1),[O,L]=(0,o.useState)(null),[P,T]=(0,o.useState)([]);(0,o.useEffect)(()=>{e&&t?document.title="Editing Form ".concat(t," - ").concat(e," - AppBot 2.0"):document.title="Editing Form - AppBot 2.0"},[e,t]),(0,o.useEffect)(()=>{(async function(){try{let n=await fetch("/api/developer/current-user"),a=n.ok?await n.json():null;L(a);let s=await fetch("/api/developer/plans"),o=s.ok?await s.json():[];if(T(o),e&&t){let n=await fetch("/api/forms/".concat(e,"/questions/").concat(t)),a=await n.json();Array.isArray(a)&&(l(a),u(a.map(e=>e.id)))}}catch(e){console.error("Failed to fetch initial data:",e)}finally{h(!1)}})()},[e,t]);let R=((null==O?void 0:O.plan)||"Free").trim().toLowerCase(),H=P.find(e=>e.name.trim().toLowerCase()===R),I=(null==H?void 0:H.max_questions)||5,J=JSON.stringify(n.map(e=>e.id))!==JSON.stringify(d),Y=async()=>{try{(await fetch("/api/forms/".concat(e,"/questions/").concat(t,"/reorder"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:n.map(e=>e.id)})})).ok&&u(n.map(e=>e.id))}catch(e){console.error("Save error:",e)}},K=async()=>{if(j.trim()){if(n.length>=I){A(!0);return}try{let n=await fetch("/api/forms/".concat(e,"/questions/").concat(t,"/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:j,type:f,word_count_min:N?parseInt(N):null})});if(n.ok){let e=await n.json();l(t=>[...t,e]),u(t=>[...t,e.id]),x(""),E(""),v("short"),_(!1)}else console.error("Error creating question")}catch(e){console.error("❌ Error submitting new question:",e)}}},z=async n=>{try{(await fetch("/api/forms/".concat(e,"/questions/").concat(t,"/delete?id=").concat(n),{method:"DELETE"})).ok?(l(e=>e.filter(e=>e.id!==n)),u(e=>e.filter(e=>e!==n)),B(null)):console.error("❌ Failed to delete question")}catch(e){console.error("❌ Delete error:",e)}},W=e=>{var t;y(e.id),F(e.question),b(e.type),k(null!==(t=e.word_count_min)&&void 0!==t?t:"")},Z=()=>{y(null),F(""),b(""),k("")},M=async a=>{try{if((await fetch("/api/forms/".concat(e,"/questions/").concat(t,"/edit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,question:C,type:S,word_count_min:w?parseInt(w):null})})).ok){let e=n.map(e=>e.id===a?{...e,question:C,type:S,word_count_min:w}:e);l(e),Z()}else console.error("Failed to update question.")}catch(e){console.error("Error saving edits:",e)}};return(0,a.jsxs)("div",{className:c().wrapper,children:[(0,a.jsxs)("div",{className:c().header,children:[(0,a.jsx)("h1",{className:c().title,children:"\uD83D\uDCDD Editing Form"}),!p&&(0,a.jsx)("button",{className:c().addButton,onClick:()=>_(!0),children:"➕"})]}),p&&(0,a.jsxs)("div",{className:c().createArea,children:[(0,a.jsx)("input",{placeholder:"Enter question...",className:c().input,value:j,onChange:e=>x(e.target.value)}),(0,a.jsxs)("select",{value:f,onChange:e=>v(e.target.value),className:c().input,children:[(0,a.jsx)("option",{value:"short",children:"Short Answer"}),(0,a.jsx)("option",{value:"long",children:"Long Answer"}),(0,a.jsx)("option",{value:"yesno",children:"Yes / No"})]}),(0,a.jsx)("input",{type:"number",placeholder:"Min Words",className:c().input,value:N,onChange:e=>E(e.target.value)}),(0,a.jsx)("button",{className:c().confirm,onClick:K,children:"✅"}),(0,a.jsx)("button",{className:c().cancel,onClick:()=>_(!1),children:"❌"})]}),!m&&n.length>0&&(0,a.jsxs)(a.Fragment,{children:[J&&(0,a.jsxs)("div",{className:c().reorderBar,children:[(0,a.jsx)("button",{className:c().saveOrder,onClick:Y,children:"\uD83D\uDCBE Save Order"}),(0,a.jsx)("button",{className:c().cancelOrder,onClick:()=>{l([...d].map(e=>n.find(t=>t.id===e)))},children:"❌ Cancel"})]}),(0,a.jsxs)("div",{className:c().tableHeader,children:[(0,a.jsx)("span",{children:"Question"}),(0,a.jsx)("span",{children:"Type"}),(0,a.jsx)("span",{children:"Min-Words"}),(0,a.jsx)("span",{children:"Actions"})]})]}),m?(0,a.jsx)("p",{className:c().status,children:"Loading questions..."}):0===n.length?(0,a.jsx)("p",{className:c().status,children:"\uD83D\uDCED Form Empty"}):(0,a.jsxs)(r.Z5,{onDragEnd:e=>{if(!e.destination)return;let t=Array.from(n),[a]=t.splice(e.source.index,1);t.splice(e.destination.index,0,a),l(t)},children:[(0,a.jsx)(i,{droppableId:"questions",children:e=>(0,a.jsxs)("ul",{className:c().questionList,...e.droppableProps,ref:e.innerRef,children:[n.map((e,t)=>(0,a.jsx)(r._l,{draggableId:String(e.id),index:t,children:t=>{var n;return(0,a.jsx)("li",{className:c().questionCard,ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,children:g===e.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{value:C,onChange:e=>F(e.target.value),className:c().input}),(0,a.jsxs)("select",{value:S,onChange:e=>b(e.target.value),className:c().input,children:[(0,a.jsx)("option",{value:"short",children:"Short"}),(0,a.jsx)("option",{value:"long",children:"Long"}),(0,a.jsx)("option",{value:"yesno",children:"Yes/No"})]}),(0,a.jsx)("input",{type:"number",value:w,onChange:e=>k(e.target.value),className:c().input}),(0,a.jsxs)("div",{className:c().formActions,children:[(0,a.jsx)("button",{className:c().iconButton,onClick:()=>M(e.id),children:"✅"}),(0,a.jsx)("button",{className:c().iconButtonDelete,onClick:Z,children:"❌"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:e.question}),(0,a.jsx)("span",{children:e.type}),(0,a.jsx)("span",{children:null!==(n=e.word_count_min)&&void 0!==n?n:"N/A"}),(0,a.jsxs)("div",{className:c().formActions,children:[(0,a.jsx)("button",{className:c().iconButton,onClick:()=>W(e),title:"Edit",children:"✏️"}),(0,a.jsx)("button",{className:c().iconButtonDelete,title:"Delete",onClick:()=>B(e.id),children:"\uD83D\uDDD1️"})]})]})})}},e.id)),e.placeholder]})}),null!==q&&(0,a.jsx)("div",{className:c().modalBackdrop,children:(0,a.jsxs)("div",{className:c().modal,children:[(0,a.jsx)("p",{children:"Are you sure you want to delete this question?"}),(0,a.jsxs)("div",{className:c().modalButtons,children:[(0,a.jsx)("button",{className:c().confirm,onClick:()=>z(q),children:"✅ Confirm"}),(0,a.jsx)("button",{className:c().cancel,onClick:()=>B(null),children:"❌ Cancel"})]})]})}),D&&(0,a.jsx)("div",{className:c().modalBackdrop,children:(0,a.jsxs)("div",{className:c().modal,children:[(0,a.jsxs)("p",{children:["You have reached the max number of questions (",I,") allowed for your plan (",(null==H?void 0:H.name)||"Free",")."]}),(0,a.jsx)("div",{className:c().modalButtons,children:(0,a.jsx)("button",{className:c().confirm,onClick:()=>A(!1),children:"OK"})})]})})]})]})}},2404:function(e){e.exports={wrapper:"EditForm_wrapper__lvIBf",header:"EditForm_header___wRHA",title:"EditForm_title__xqTzo",addButton:"EditForm_addButton__7tBg6",createArea:"EditForm_createArea__Ckxzy",input:"EditForm_input__w1Lpi",confirm:"EditForm_confirm__LIsoR",cancel:"EditForm_cancel__YYtan",status:"EditForm_status__Td8ed",reorderBar:"EditForm_reorderBar__dCo_4",saveOrder:"EditForm_saveOrder___NtB6",cancelOrder:"EditForm_cancelOrder__mSysC",tableHeader:"EditForm_tableHeader__ZrglN",questionList:"EditForm_questionList__eWDbk",questionCard:"EditForm_questionCard__dE1uO",formActions:"EditForm_formActions__XZHc1",iconButton:"EditForm_iconButton__gXCLA",iconButtonDelete:"EditForm_iconButtonDelete__RPgKo",select:"EditForm_select__5jEF6",inputSmall:"EditForm_inputSmall__SvKRq",modalBackdrop:"EditForm_modalBackdrop__PLbz_",modal:"EditForm_modal__R7uky",modalButtons:"EditForm_modalButtons__cLd00"}}},function(e){e.O(0,[216,373,971,69,744],function(){return e(e.s=22234)}),_N_E=e.O()}]);