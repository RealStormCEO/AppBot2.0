(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{24202:function(e,a,t){Promise.resolve().then(t.bind(t,233))},47907:function(e,a,t){"use strict";var o=t(15313);t.o(o,"useParams")&&t.d(a,{useParams:function(){return o.useParams}}),t.o(o,"usePathname")&&t.d(a,{usePathname:function(){return o.usePathname}}),t.o(o,"useRouter")&&t.d(a,{useRouter:function(){return o.useRouter}})},95601:function(e,a){"use strict";function t(){return null}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return t}}),("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),e.exports=a.default)},233:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return h}});var o=t(57437),n=t(47907),s=t(2265),r=t(95601),l=t.n(r),i=t(478),c=t.n(i),d=t(71126);function u(e){let{children:a}=e,{data:t,status:r}=(0,d.useSession)(),l=(0,n.useRouter)();return((0,s.useEffect)(()=>{"unauthenticated"===r&&l.push("/home")},[r,l]),"loading"===r)?(0,o.jsx)("p",{children:"Loading..."}):t?a:null}function h(){let{guild_id:e}=(0,n.useParams)(),a=(0,n.useRouter)(),[t,r]=(0,s.useState)([]),[i,d]=(0,s.useState)(!1),[h,m]=(0,s.useState)(""),[_,f]=(0,s.useState)(null),[p,b]=(0,s.useState)([]),[j,x]=(0,s.useState)(""),[D,v]=(0,s.useState)(""),[g,N]=(0,s.useState)(""),[y,C]=(0,s.useState)(null),[B,k]=(0,s.useState)([]),[w,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>{!async function(){try{let a=await fetch("/api/developer/current-user"),t=a.ok?await a.json():null;C(t);let o=await fetch("/api/developer/plans"),n=o.ok?await o.json():[];if(k(n),e){let a=await fetch("/api/forms/".concat(e)),t=a.ok?await a.json():[];r(t);let o=await fetch("/api/forms/".concat(e,"/channels")),n=o.ok?await o.json():[];b(n)}}catch(e){console.error("Failed to fetch initial data",e)}}()},[e]);let O=((null==y?void 0:y.plan)||"Free").trim().toLowerCase(),E=B.find(e=>e.name.trim().toLowerCase()===O),P=(null==E?void 0:E.max_forms)||1,A=async()=>{if(N(""),h.trim()&&j){if(t.length>=P){S(!0);return}try{let a=await fetch("/api/forms/".concat(e,"/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:h,log_channel_id:j})});if(a.ok){let e=await a.json();r(a=>[...a,e]),m(""),x(""),d(!1)}else{let e=await a.text();N("Failed to create form: "+e)}}catch(e){console.error("Error creating form:",e),N("Error creating form")}}},T=async()=>{if(_)try{let a=await fetch("/api/forms/".concat(e,"/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:_.id})}),t=await a.json();t.success?(r(e=>e.filter(e=>e.id!==_.id)),f(null)):console.error("Delete failed:",t.error)}catch(e){console.error("❌ Delete error:",e)}};return(0,s.useEffect)(()=>{e&&(document.title="Dashboard - ".concat(e," - AppBot 2.0"))},[e]),(0,o.jsx)(u,{children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(l(),{children:[(0,o.jsxs)("title",{children:["Dashboard - ",e," - AppBot 2.0"]}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsxs)("div",{className:c().containerWithSidebar,children:[(0,o.jsxs)("div",{className:c().formsHeader,children:[(0,o.jsx)("h1",{className:c().heading,children:"\uD83D\uDCCB Application Forms"}),!i&&(0,o.jsx)("button",{className:c().createButton,onClick:()=>d(!0),title:"Create New Form",children:"➕"})]}),g&&(0,o.jsx)("p",{style:{color:"red",textAlign:"center"},children:g}),i&&(0,o.jsxs)("div",{className:c().createModal,children:[(0,o.jsx)("input",{type:"text",value:h,placeholder:"Enter form name",onChange:e=>m(e.target.value),className:c().input}),(0,o.jsxs)("select",{value:j,onChange:e=>x(e.target.value),className:c().select,children:[(0,o.jsx)("option",{value:"",children:"Select Log Channel"}),p.map(e=>(0,o.jsxs)("option",{value:e.id,children:["#",e.name]},e.id))]}),(0,o.jsx)("button",{className:c().confirmButton,onClick:A,children:"✅"}),(0,o.jsx)("button",{className:c().cancelButton,onClick:()=>d(!1),children:"❌"})]}),t.map(t=>(0,o.jsxs)("div",{className:c().formCard,children:[(0,o.jsx)("span",{className:c().formTitle,children:t.title}),(0,o.jsx)("select",{className:c().selectInline,value:t.log_channel_id||"",onChange:async a=>{let o=a.target.value;(await fetch("/api/forms/".concat(e,"/update-channel"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:t.id,log_channel_id:o})})).ok?(r(e=>e.map(e=>e.id===t.id?{...e,log_channel_id:o}:e)),v("✅ Log channel updated."),setTimeout(()=>v(""),2500)):console.error("❌ Failed to update log channel")},children:p.map(e=>(0,o.jsxs)("option",{value:e.id,children:["#",e.name]},e.id))}),(0,o.jsxs)("div",{className:c().formActions,children:[(0,o.jsx)("button",{className:c().iconButton,title:"Edit",onClick:()=>a.push("/dashboard/".concat(e,"/edit/").concat(t.id)),children:"✏️"}),(0,o.jsx)("button",{className:c().iconButtonDelete,title:"Delete",onClick:()=>f(t),children:"\uD83D\uDDD1️"})]})]},t.id)),_&&(0,o.jsx)("div",{className:c().modalOverlay,children:(0,o.jsxs)("div",{className:c().modal,children:[(0,o.jsx)("h3",{children:"Delete Form"}),(0,o.jsxs)("p",{children:["Are you sure you want to delete ",(0,o.jsx)("strong",{children:_.title}),"?"]}),(0,o.jsxs)("div",{className:c().modalActions,children:[(0,o.jsx)("button",{onClick:()=>f(null),children:"Cancel"}),(0,o.jsx)("button",{onClick:T,className:c().danger,children:"Yes, Delete"})]})]})}),w&&(0,o.jsx)("div",{className:c().modalBackdrop,children:(0,o.jsxs)("div",{className:c().modal,children:[(0,o.jsxs)("p",{children:["You have reached the max number of forms (",P,") allowed for your plan (",(null==y?void 0:y.plan)||"Free",")."]}),(0,o.jsx)("div",{className:c().modalButtons,children:(0,o.jsx)("button",{className:c().confirm,onClick:()=>S(!1),children:"OK"})})]})})]})]})})}},478:function(e){e.exports={heading:"Dashboard_heading__WXdpx",formTitle:"Dashboard_formTitle__Q7xzI",container:"Dashboard_container__oj949",subtext:"Dashboard_subtext__xL6KK",createButton:"Dashboard_createButton__vNIyt",formsGrid:"Dashboard_formsGrid__wv6Tm",formCard:"Dashboard_formCard__UEeRX",formActions:"Dashboard_formActions__j3Thz",edit:"Dashboard_edit__YPOJl",delete:"Dashboard_delete__G4ICV",iconButton:"Dashboard_iconButton__D97Rj",iconButtonDelete:"Dashboard_iconButtonDelete__FxMvQ",createModal:"Dashboard_createModal__vX3bk",input:"Dashboard_input__BrxKO",confirmButton:"Dashboard_confirmButton__JPiAw",cancelButton:"Dashboard_cancelButton____2HW",modalOverlay:"Dashboard_modalOverlay__BCr4E",modal:"Dashboard_modal__XNgjk",modalActions:"Dashboard_modalActions__oCavV",danger:"Dashboard_danger__ViR_F",formsHeader:"Dashboard_formsHeader__L7LXX",select:"Dashboard_select__73E6I",selectInline:"Dashboard_selectInline__T81vE",successMessage:"Dashboard_successMessage__2wmoh",modalBackdrop:"Dashboard_modalBackdrop__mrOUA",modalButtons:"Dashboard_modalButtons__LlDlI",confirm:"Dashboard_confirm__6LbdN"}}},function(e){e.O(0,[126,971,69,744],function(){return e(e.s=24202)}),_N_E=e.O()}]);