(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[110],{5617:function(e,t,l){Promise.resolve().then(l.bind(l,46878))},47907:function(e,t,l){"use strict";var a=l(15313);l.o(a,"useParams")&&l.d(t,{useParams:function(){return a.useParams}}),l.o(a,"usePathname")&&l.d(t,{usePathname:function(){return a.usePathname}}),l.o(a,"useRouter")&&l.d(t,{useRouter:function(){return a.useRouter}})},46878:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return u}});var a=l(57437),n=l(47907),s=l(2265),i=l(28802),r=l.n(i),o=l(94220),d=l.n(o);function c(e){let{guild_id:t,type:l,onSave:n,onCancel:i}=e,[r,o]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[_,m]=(0,s.useState)("#0099ff"),[h,p]=(0,s.useState)("#0099ff"),[b,g]=(0,s.useState)(!1),[v,x]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[y,N]=(0,s.useState)(""),[S,B]=(0,s.useState)(!1),[C,w]=(0,s.useState)(""),[E,T]=(0,s.useState)(""),[k,A]=(0,s.useState)(""),[R,F]=(0,s.useState)(""),[I,L]=(0,s.useState)([]),[D,P]=(0,s.useState)(!0),[U,O]=(0,s.useState)(null),[M,W]=(0,s.useState)(!1),q=[{label:"{server.name}",description:"Server Name",usage:"Replaced with the server's name"},{label:"{server.id}",description:"Server ID",usage:"Replaced with the server's unique ID"},{label:"{user.name}",description:"User Name",usage:"Replaced with the user's username"},{label:"{user.id}",description:"User ID",usage:"Replaced with the user's unique ID"},{label:"{user.tag}",description:"User Tag",usage:"Replaced with the user's full tag (username#1234)"}],J=(0,s.useRef)(null),V=(0,s.useRef)(null),X=(0,s.useRef)([]),z=(0,s.useRef)([]),G=function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!(null==e?void 0:e.current))return;let n=e.current,s=n.selectionStart,i=n.selectionEnd,r=n.value,d=r.substring(0,s)+t+r.substring(i);if(n.value=d,n===J.current)o(d);else if(n===V.current)u(d);else if("name"===l&&null!==a){let e=[...I];e[a].name=d,L(e)}else if("value"===l&&null!==a){let e=[...I];e[a].value=d,L(e)}let c=s+t.length;setTimeout(()=>{n.selectionStart=n.selectionEnd=c,n.focus()},0)},H=(e,t,l)=>{let a=[...I];a[e][t]=l,L(a)},Y=e=>L(I.filter((t,l)=>l!==e)),K=e=>parseInt(e.replace("#",""),16);function Q(e){if("object"!=typeof e||null===e)return e;let t=Array.isArray(e)?[]:{};for(let l in e){let a=e[l];if(null!=a&&("string"!=typeof a||""!==a.trim())){if("object"==typeof a){let e=Q(a);Array.isArray(e)?e.length>0&&(t[l]=e):e&&Object.keys(e).length>0&&(t[l]=e)}else t[l]=a}}return t}return((0,s.useEffect)(()=>{if(console.log("EmbedBuilder useEffect triggered",{guild_id:t,type:l}),!t){O("Missing guild ID"),P(!1);return}P(!0),O(null),async function(){try{let n=await fetch("/api/guilds/".concat(t));if(console.log("API response status:",n.status),!n.ok)throw Error("HTTP ".concat(n.status," - ").concat(n.statusText));let s=await n.json();console.log("API data:",s);let i="accept"===l?s.dm_accept_embed:s.dm_deny_embed,r=i?JSON.parse(i):null;if(r){var e,a;let t=Q(r);if(console.log("Cleaned embed:",t),o(t.title||""),u(t.description||""),void 0!==t.color){let e="#0099ff";try{e="#"+Number(t.color).toString(16).padStart(6,"0")}catch(e){}m(e),p(e)}else m("#0099ff"),p("#0099ff");t.author?(g(!0),x(t.author.name||""),j(t.author.url||""),N(t.author.icon_url||"")):(g(!1),x(""),j(""),N("")),t.footer?(B(!0),w(t.footer.text||""),T(t.footer.icon_url||"")):(B(!1),w(""),T("")),A((null===(e=t.thumbnail)||void 0===e?void 0:e.url)||""),F((null===(a=t.image)||void 0===a?void 0:a.url)||""),Array.isArray(t.fields)?L(t.fields.map(e=>({name:e.name||"",value:e.value||"",inline:!!e.inline}))):L([])}else o(""),u(""),m("#0099ff"),p("#0099ff"),g(!1),x(""),j(""),N(""),B(!1),w(""),T(""),A(""),F(""),L([])}catch(e){console.error("Failed to fetch embed:",e),O("Failed to load embed data: "+e.message)}finally{P(!1)}}()},[t,l]),D)?(0,a.jsx)("p",{style:{color:"white",textAlign:"center",marginTop:"2rem"},children:"Loading embed data..."}):U?(0,a.jsx)("p",{style:{color:"red",textAlign:"center",marginTop:"2rem"},children:U}):D?(0,a.jsx)("p",{children:"Loading embed data..."}):U?(0,a.jsx)("p",{style:{color:"red"},children:U}):(0,a.jsxs)("div",{className:d().container,children:[(0,a.jsx)("h2",{className:d().heading,children:"accept"===l?"DM Accept Embed Builder":"DM Deny Embed Builder"}),(0,a.jsx)("label",{className:d().label,children:"Title"}),(0,a.jsx)("textarea",{ref:J,value:r,onChange:e=>o(e.target.value),className:d().input,placeholder:"Embed title"}),(0,a.jsx)("div",{className:d().placeholders,children:q.map(e=>(0,a.jsx)("button",{type:"button",className:d().placeholderButton,title:"".concat(e.description," - ").concat(e.usage),onClick:()=>G(J,e.label),children:e.label},e.label))}),(0,a.jsx)("label",{className:d().label,children:"Description"}),(0,a.jsx)("textarea",{ref:V,value:c,onChange:e=>u(e.target.value),className:d().textarea,placeholder:"Embed description"}),(0,a.jsx)("div",{className:d().placeholders,children:q.map(e=>(0,a.jsx)("button",{type:"button",className:d().placeholderButton,title:"".concat(e.description," - ").concat(e.usage),onClick:()=>G(V,e.label),children:e.label},e.label+"-desc"))}),(0,a.jsx)("label",{className:d().label,children:"Color"}),(0,a.jsx)("input",{type:"color",value:h,onChange:e=>p(e.target.value),onBlur:()=>m(h),className:d().colorInput}),(0,a.jsx)("div",{className:d().toggleContainer,children:(0,a.jsxs)("label",{className:d().toggleSwitch,children:[(0,a.jsx)("input",{type:"checkbox",checked:b,onChange:()=>g(!b)}),(0,a.jsx)("span",{className:d().slider}),"Include Author"]})}),b&&(0,a.jsxs)("div",{className:d().group,children:[(0,a.jsx)("div",{className:d().groupTitle,children:"Author"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>x(e.target.value),className:d().input,placeholder:"Name"}),(0,a.jsx)("input",{type:"url",value:f,onChange:e=>j(e.target.value),className:d().input,placeholder:"URL"}),(0,a.jsx)("input",{type:"url",value:y,onChange:e=>N(e.target.value),className:d().input,placeholder:"Icon URL"})]}),(0,a.jsx)("div",{className:d().toggleContainer,children:(0,a.jsxs)("label",{className:d().toggleSwitch,children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:()=>B(!S)}),(0,a.jsx)("span",{className:d().slider}),"Include Footer"]})}),S&&(0,a.jsxs)("div",{className:d().group,children:[(0,a.jsx)("div",{className:d().groupTitle,children:"Footer"}),(0,a.jsx)("input",{type:"text",value:C,onChange:e=>w(e.target.value),className:d().input,placeholder:"Text"}),(0,a.jsx)("input",{type:"url",value:E,onChange:e=>T(e.target.value),className:d().input,placeholder:"Icon URL"})]}),(0,a.jsx)("label",{className:d().label,children:"Thumbnail URL"}),(0,a.jsx)("input",{type:"url",value:k,onChange:e=>A(e.target.value),className:d().input,placeholder:"Thumbnail image URL"}),(0,a.jsx)("label",{className:d().label,children:"Image URL"}),(0,a.jsx)("input",{type:"url",value:R,onChange:e=>F(e.target.value),className:d().input,placeholder:"Image URL"}),(0,a.jsxs)("div",{className:d().fieldsContainer,children:[(0,a.jsx)("h3",{children:"Fields"}),0===I.length&&(0,a.jsx)("p",{className:d().noFields,children:"No fields added yet."}),I.map((e,t)=>(0,a.jsxs)("div",{className:d().field,children:[(0,a.jsx)("label",{className:d().label,children:"Field Name"}),(0,a.jsx)("input",{type:"text",value:e.name,placeholder:"Field name",onChange:e=>H(t,"name",e.target.value),className:d().input,ref:e=>X.current[t]=e}),(0,a.jsx)("div",{className:d().placeholders,children:q.map(e=>(0,a.jsx)("button",{type:"button",className:d().placeholderButton,title:"".concat(e.description," - ").concat(e.usage),onClick:()=>G({current:X.current[t]},e.label,"name",t),children:e.label},e.label+"-fieldname-"+t))}),(0,a.jsx)("label",{className:d().label,children:"Field Value"}),(0,a.jsx)("textarea",{value:e.value,placeholder:"Field value",onChange:e=>H(t,"value",e.target.value),className:d().textarea,ref:e=>z.current[t]=e}),(0,a.jsx)("div",{className:d().placeholders,children:q.map(e=>(0,a.jsx)("button",{type:"button",className:d().placeholderButton,title:"".concat(e.description," - ").concat(e.usage),onClick:()=>G({current:z.current[t]},e.label,"value",t),children:e.label},e.label+"-fieldvalue-"+t))}),(0,a.jsxs)("label",{className:d().inlineLabel,children:[(0,a.jsx)("input",{type:"checkbox",checked:e.inline,onChange:e=>H(t,"inline",e.target.checked)}),"Inline"]}),(0,a.jsx)("button",{type:"button",onClick:()=>Y(t),className:d().removeButton,children:"Remove Field"})]},t)),(0,a.jsx)("button",{type:"button",onClick:()=>L([...I,{name:"",value:"",inline:!1}]),className:d().addButton,children:"Add Field"})]}),(0,a.jsxs)("div",{className:d().buttonsContainer,children:[(0,a.jsx)("button",{onClick:()=>W(!0),className:d().variableButton,children:"Show Available Variables"}),(0,a.jsx)("button",{onClick:()=>{let e={title:r,description:c,color:K(_),fields:I.filter(e=>e.name&&e.value)};b&&(e.author={name:v,...f?{url:f}:{},...y?{icon_url:y}:{}}),S&&(e.footer={text:C,...E?{icon_url:E}:{}}),k&&(e.thumbnail={url:k}),R&&(e.image={url:R}),n(Q(e))},className:d().saveButton,children:"Save Embed"}),(0,a.jsx)("button",{onClick:i,className:d().cancelButton,children:"Cancel"})]}),M&&(0,a.jsx)("div",{className:d().modalBackdrop,children:(0,a.jsxs)("div",{className:d().modal,children:[(0,a.jsx)("h3",{children:"Available Variables"}),(0,a.jsx)("ul",{className:d().variableList,children:q.map(e=>(0,a.jsxs)("li",{className:d().variableItem,children:[(0,a.jsx)("strong",{children:e.label}),": ",e.description," — ",(0,a.jsx)("em",{children:e.usage})]},e.label))}),(0,a.jsx)("button",{className:d().confirmButton,onClick:()=>W(!1),children:"Close"})]})})]})}function u(){(0,n.useRouter)();let{guild_id:e}=(0,n.useParams)(),[t,l]=(0,s.useState)({dm_accept_enabled:!1,dm_deny_enabled:!1,auto_deny_enabled:!1,auto_deny_threshold:0,dm_accept_embed:null,dm_deny_embed:null,roles_to_add:[],roles_to_remove:[]}),[i,o]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[_,m]=(0,s.useState)({title:"",description:"",color:"#0099ff",fields:[]}),[h,p]=(0,s.useState)([]);(0,s.useEffect)(()=>{async function a(){try{var a;let n=await fetch("/api/guild-settings/".concat(e));if(!n.ok)throw Error("Failed to fetch guild settings");let s=await n.json();if("string"==typeof s.dm_accept_embed)try{s.dm_accept_embed=JSON.parse(s.dm_accept_embed)}catch(e){s.dm_accept_embed=null}if("string"==typeof s.dm_deny_embed)try{s.dm_deny_embed=JSON.parse(s.dm_deny_embed)}catch(e){s.dm_deny_embed=null}s.roles_to_add=Array.isArray(s.roles_to_add)?s.roles_to_add:[],s.roles_to_remove=Array.isArray(s.roles_to_remove)?s.roles_to_remove:[],l({...t,...s,auto_deny_enabled:s.auto_deny_enabled||!1,auto_deny_threshold:null!==(a=s.auto_deny_threshold)&&void 0!==a?a:0})}catch(e){console.error("Failed to fetch guild settings",e)}finally{o(!1)}}async function n(){try{let t=await fetch("/api/guilds/".concat(e,"/roles"));if(!t.ok)throw Error("Failed to fetch roles");let l=await t.json();p(l.filter(t=>String(t.id)!==String(e)))}catch(e){console.error("Failed to fetch server roles",e)}}e&&(a(),n())},[e]),(0,s.useEffect)(()=>{e?document.title="Settings - ".concat(e," - AppBot 2.0"):document.title="Settings - AppBot 2.0"},[e]);let b=async t=>{try{var a;if(!(await fetch("/api/guild-settings/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,dm_accept_embed:t.dm_accept_embed?JSON.stringify(t.dm_accept_embed):null,dm_deny_embed:t.dm_deny_embed?JSON.stringify(t.dm_deny_embed):null,roles_to_add:t.roles_to_add||[],roles_to_remove:t.roles_to_remove||[],auto_deny_enabled:t.auto_deny_enabled||!1,auto_deny_threshold:null!==(a=t.auto_deny_threshold)&&void 0!==a?a:0})})).ok)throw Error("Failed to save settings");l(t)}catch(e){console.error(e),alert("Failed to save settings")}},g=async e=>{let l={...t};"accept"===e?l.dm_accept_enabled=!l.dm_accept_enabled:"deny"===e&&(l.dm_deny_enabled=!l.dm_deny_enabled),await b(l)},v=async()=>{let e={...t};e.auto_deny_enabled=!e.auto_deny_enabled,await b(e)},x=async e=>{let l={...t},a=Number(e);l.auto_deny_threshold=isNaN(a)?0:Math.min(Math.max(a,0),100),await b(l)},f=e=>{m(("accept"===e?t.dm_accept_embed:t.dm_deny_embed)||{title:"",description:"",color:"#0099ff",fields:[]}),u(e)},j=(e,l)=>{if(!e)return;let a={...t};"add"===l?(a.roles_to_remove=a.roles_to_remove.filter(t=>t!==e),a.roles_to_add.includes(e)||(a.roles_to_add=[...a.roles_to_add,e])):"remove"!==l||(a.roles_to_add=a.roles_to_add.filter(t=>t!==e),a.roles_to_remove.includes(e)||(a.roles_to_remove=[...a.roles_to_remove,e])),b(a)},y=(e,l)=>{let a={...t};"add"===l?a.roles_to_add=a.roles_to_add.filter(t=>t!==e):"remove"===l&&(a.roles_to_remove=a.roles_to_remove.filter(t=>t!==e)),b(a)};return d?(0,a.jsx)(c,{initialEmbed:_,onSave:e=>{let a={...t};"accept"===d?a.dm_accept_embed=e:"deny"===d&&(a.dm_deny_embed=e),l(a),b(a),u(null)},onCancel:()=>u(null),type:d,guild_id:e}):i?(0,a.jsx)("p",{className:r().loading,children:"Loading..."}):(0,a.jsxs)("div",{className:r().container,children:[(0,a.jsx)("h1",{className:r().title,children:"Settings"}),(0,a.jsxs)("div",{className:r().cardsWrapper,children:[(0,a.jsxs)("div",{className:r().card,children:[(0,a.jsx)("h2",{className:r().cardTitle,children:"DM Settings"}),(0,a.jsxs)("div",{className:r().option,children:[(0,a.jsxs)("label",{className:r().switchLabel,children:["DM on Accept?",(0,a.jsx)("input",{type:"checkbox",checked:t.dm_accept_enabled,onChange:()=>g("accept"),className:r().switchInput}),(0,a.jsx)("span",{className:r().switchSlider})]}),t.dm_accept_enabled&&(0,a.jsx)("button",{className:r().settingsButton,onClick:()=>f("accept"),children:"⚙️"})]}),(0,a.jsxs)("div",{className:r().option,children:[(0,a.jsxs)("label",{className:r().switchLabel,children:["DM on Deny?",(0,a.jsx)("input",{type:"checkbox",checked:t.dm_deny_enabled,onChange:()=>g("deny"),className:r().switchInput}),(0,a.jsx)("span",{className:r().switchSlider})]}),t.dm_deny_enabled&&(0,a.jsx)("button",{className:r().settingsButton,onClick:()=>f("deny"),children:"⚙️"})]}),(0,a.jsxs)("div",{className:r().optionGroup,children:[(0,a.jsx)("div",{className:r().option,children:(0,a.jsxs)("label",{className:r().switchLabel,children:["Auto Deny?",(0,a.jsx)("input",{type:"checkbox",checked:t.auto_deny_enabled,onChange:v,className:r().switchInput}),(0,a.jsx)("span",{className:r().switchSlider})]})}),t.auto_deny_enabled&&(0,a.jsxs)("div",{className:r().autoDenySettings,children:[(0,a.jsx)("label",{htmlFor:"autoDenyThreshold",className:r().label,children:"Human Threshold (0 to 100):"}),(0,a.jsx)("input",{type:"number",id:"autoDenyThreshold",min:"0",max:"100",step:"1",value:t.auto_deny_threshold,onChange:e=>x(e.target.value),className:r().input})]})]})]}),(0,a.jsxs)("div",{className:r().card,children:[(0,a.jsx)("h2",{className:r().cardTitle,children:"Roles to Add / Remove on Accept"}),(0,a.jsx)("label",{className:r().label,htmlFor:"rolesToAddSelect",children:"Add Role:"}),(0,a.jsxs)("select",{id:"rolesToAddSelect",onChange:e=>{j(e.target.value,"add"),e.target.value=""},defaultValue:"",className:r().input,children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Select a role to add"}),h.filter(e=>!t.roles_to_add.includes(e.id)&&!t.roles_to_remove.includes(e.id)).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("div",{className:r().roleTagsContainer,children:t.roles_to_add.map(e=>{let t=h.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:r().roleTag,children:[t.name,(0,a.jsx)("button",{type:"button",className:r().removeTagButton,onClick:()=>y(e,"add"),children:"\xd7"})]},e):null})}),(0,a.jsx)("label",{className:r().label,htmlFor:"rolesToRemoveSelect",children:"Remove Role:"}),(0,a.jsxs)("select",{id:"rolesToRemoveSelect",onChange:e=>{j(e.target.value,"remove"),e.target.value=""},defaultValue:"",className:r().input,children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Select a role to remove"}),h.filter(e=>!t.roles_to_add.includes(e.id)&&!t.roles_to_remove.includes(e.id)).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("div",{className:r().roleTagsContainer,children:t.roles_to_remove.map(e=>{let t=h.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:r().roleTag,children:[t.name,(0,a.jsx)("button",{type:"button",className:r().removeTagButton,onClick:()=>y(e,"remove"),children:"\xd7"})]},e):null})})]})]})]})}},28802:function(e){e.exports={container:"Settings_container__BZqAs",title:"Settings_title__Kh4Qo",cardsWrapper:"Settings_cardsWrapper___Sdn4",card:"Settings_card__707wW",cardTitle:"Settings_cardTitle__xi9_1",option:"Settings_option__C41S3",label:"Settings_label__Cd37X",settingsButton:"Settings_settingsButton__cBWoQ",switchLabel:"Settings_switchLabel__w0_qn",switchInput:"Settings_switchInput__49Vj2",switchSlider:"Settings_switchSlider__BWn2c",input:"Settings_input__1wCcN",roleTagsContainer:"Settings_roleTagsContainer__nHJSN",roleTag:"Settings_roleTag__6YPD4",removeTagButton:"Settings_removeTagButton__UIOL8",loading:"Settings_loading__I2ZyB",optionGroup:"Settings_optionGroup__X3_pj",autoDenySettings:"Settings_autoDenySettings__ovkfO"}},94220:function(e){e.exports={container:"EmbedBuilder_container__Y9ici",heading:"EmbedBuilder_heading__mdhT4",group:"EmbedBuilder_group__yh7Bj",groupTitle:"EmbedBuilder_groupTitle__c6Aci",label:"EmbedBuilder_label__U5a7W",input:"EmbedBuilder_input__FPqq9",textarea:"EmbedBuilder_textarea__w4zB7",colorInput:"EmbedBuilder_colorInput__K3sac",fieldsContainer:"EmbedBuilder_fieldsContainer__OXvfL",noFields:"EmbedBuilder_noFields__7X62h",field:"EmbedBuilder_field__4aUva",inlineLabel:"EmbedBuilder_inlineLabel__9NR34",removeButton:"EmbedBuilder_removeButton__qGSXp",addButton:"EmbedBuilder_addButton__PzWcg",buttonsContainer:"EmbedBuilder_buttonsContainer___zFv4",saveButton:"EmbedBuilder_saveButton__zkMMn",cancelButton:"EmbedBuilder_cancelButton__lhuhf",toggleContainer:"EmbedBuilder_toggleContainer__vbeHT",toggleSwitch:"EmbedBuilder_toggleSwitch__YBcSF",slider:"EmbedBuilder_slider___Awbb",placeholders:"EmbedBuilder_placeholders__Ue3ty",placeholderButton:"EmbedBuilder_placeholderButton__0bno6"}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=5617)}),_N_E=e.O()}]);