(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[829],{82273:function(e,t,n){Promise.resolve().then(n.bind(n,48662))},47907:function(e,t,n){"use strict";var r=n(15313);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},48662:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(57437),a=n(2265),s=n(71126),o=n(47907),i=n(59085),c=n.n(i);function u(){let{data:e,status:t}=(0,s.useSession)(),n=(0,o.useRouter)(),[i,u]=(0,a.useState)([]),[l,d]=(0,a.useState)(new Set),[_,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{document.title="Servers - AppBot2.0"},[]),(0,a.useEffect)(()=>{let e=localStorage.getItem("invited_guild");e&&v(e)},[]),(0,a.useEffect)(()=>{"unauthenticated"===t&&n.push("/home")},[t,n]);let h=async()=>{try{let t=await fetch("https://discord.com/api/users/@me/guilds",{headers:{Authorization:"Bearer ".concat(null==e?void 0:e.accessToken)}}),n=(await t.json()).filter(e=>(32&e.permissions)==32);u(n);let r=await fetch("/api/bot-guilds"),{ids:a}=await r.json(),s=new Set(a.map(e=>e.toString()));d(s)}catch(e){console.error("Guild fetch error:",e)}};if((0,a.useEffect)(()=>{if(!(null==e?void 0:e.accessToken))return;h();let t=setInterval(()=>{h()},3e3);return()=>clearInterval(t)},[null==e?void 0:e.accessToken]),(0,a.useEffect)(()=>{if(!(null==e?void 0:e.accessToken)||!_)return;let t=setInterval(async()=>{try{let e=await fetch("/api/bot-guilds"),{ids:t}=await e.json();new Set(t.map(e=>e.toString())).has(_)&&(localStorage.removeItem("invited_guild"),n.push("/servers"))}catch(e){console.error("Redirect check failed:",e)}},3e3);return()=>clearInterval(t)},[null==e?void 0:e.accessToken,_,n]),"loading"===t)return(0,r.jsx)("p",{children:"Loading..."});if("unauthenticated"===t)return null;let f=e=>{localStorage.setItem("invited_guild",e);let t=encodeURIComponent("".concat(window.location.origin,"/servers/invite-complete")),n="https://discord.com/oauth2/authorize?client_id=".concat("1371929881872564294","&scope=bot+applications.commands&permissions=8596544&guild_id=").concat(e,"&disable_guild_select=true&redirect_uri=").concat(t,"&response_type=code");window.location.href=n};return(0,r.jsx)("div",{className:c().container,children:i.map(e=>{let t=e.icon?"https://cdn.discordapp.com/icons/".concat(e.id,"/").concat(e.icon,".png"):"/default-icon.jpg",a=l.has(e.id);return(0,r.jsxs)("div",{className:c().card,children:[(0,r.jsx)("img",{src:t,alt:e.name,className:c().avatar,onError:e=>e.currentTarget.src="/default-icon.jpg"}),(0,r.jsx)("h3",{className:c().title,children:e.name}),a?(0,r.jsx)("button",{className:"".concat(c().button," ").concat(c().settings),onClick:()=>n.push("/dashboard/".concat(e.id)),children:"⚙️ Settings"}):(0,r.jsx)("button",{className:"".concat(c().button," ").concat(c().invite),onClick:()=>f(e.id),children:"➕ Invite Bot"})]},e.id)})})}},59085:function(e){e.exports={container:"Servers_container__ULee0",card:"Servers_card__lrXT5",avatar:"Servers_avatar__t5UdM",title:"Servers_title__G5X5j",button:"Servers_button__QCxAu",settings:"Servers_settings__L_dre",invite:"Servers_invite__qWc3D",navbar:"Servers_navbar__0I35Z",logoArea:"Servers_logoArea__J3Q0p",logoImage:"Servers_logoImage__lvjMI",brand:"Servers_brand__UBg11"}}},function(e){e.O(0,[126,971,69,744],function(){return e(e.s=82273)}),_N_E=e.O()}]);