(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[152],{43152:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return d}});var n=a(57437),o=a(71126),t=a(2265),s=a(47907),l=a(83041),i=a.n(l);function d(){var e,r,a,l;let{data:d,status:u}=(0,o.useSession)(),c=(0,s.useRouter)(),v=(0,s.usePathname)(),[p,h]=(0,t.useState)(!1),[f,_]=(0,t.useState)(!1),[m,g]=(0,t.useState)(!1),[x,j]=(0,t.useState)(""),[b,D]=(0,t.useState)(null),[w,N]=(0,t.useState)([]),[T,k]=(0,t.useState)(""),S=(0,t.useRef)(null),E=null==v?void 0:v.startsWith("/developer"),B=(()=>{let e=null==v?void 0:v.split("/");if(!e||e.length<3)return null;let[r,a,n]=e;return["dashboard","applications","settings"].includes(a)&&/^\d+$/.test(n)?n:null})();if((0,t.useEffect)(()=>{let e=e=>{S.current&&!S.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.useEffect)(()=>{(async()=>{var e;if(!(null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.id)){g(!0);return}try{let e=await fetch("/api/is-dev-user?userId=".concat(d.user.id)),r=await e.json();_(r.isDev||!1)}catch(e){console.error("\uD83D\uDD25 Failed to check dev access:",e)}finally{g(!0)}})()},[null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.id]),(0,t.useEffect)(()=>{(async()=>{if(!B){""!==x&&j("");return}if("authenticated"===u&&(null==d?void 0:d.accessToken))try{let e=await fetch("https://discord.com/api/users/@me/guilds",{headers:{Authorization:"Bearer ".concat(d.accessToken)}}),r=(await e.json()).find(e=>e.id===B);r&&j(r.name)}catch(e){console.error("⚠️ Failed to fetch guild name:",e)}})()},[B,null==d?void 0:d.accessToken,u]),(0,t.useEffect)(()=>{(async function(){var e;if(null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.id)try{let e=await fetch("/api/developer/current-user"),r=e.ok?await e.json():null;D(r);let a=await fetch("/api/developer/plans"),n=a.ok?await a.json():[];N(n)}catch(e){console.error("Failed to fetch user or plans:",e)}})()},[null==d?void 0:null===(r=d.user)||void 0===r?void 0:r.id]),(0,t.useEffect)(()=>{if(!(null==b?void 0:b.expiration_date)){k("");return}function e(){let e=new Date,r=new Date(b.expiration_date)-e;if(r<=0){k("Expired");return}let a=Math.floor(r/31536e6),n=Math.floor((r-=31536e6*a)/864e5),o=Math.floor((r-=864e5*n)/36e5),t=Math.floor((r-=36e5*o)/6e4),s=[];a>0&&s.push("".concat(a,"y")),n>0&&s.push("".concat(n,"d")),o>0&&s.push("".concat(o,"h")),s.push("".concat(t,"m")),k(s.join(", "))}e();let r=setInterval(e,6e4);return()=>clearInterval(r)},[null==b?void 0:b.expiration_date]),"loading"===u)return null;let I=x?"Editing Server: ".concat(x):"",y=((null==b?void 0:b.plan)||"Free").trim().toLowerCase(),A=w.find(e=>e.name.trim().toLowerCase()===y);return(0,n.jsxs)("div",{className:i().topbar,children:[(0,n.jsxs)("div",{className:i().logoArea,children:[(0,n.jsx)("img",{src:"/default-icon.jpg",alt:"AppBot Logo",className:i().logoImage}),(0,n.jsx)("span",{className:i().brand,children:"AppBot2.0"})]}),(E||I)&&(0,n.jsx)("div",{className:i().centerText,children:(0,n.jsx)("span",{className:i().guildName,children:E?"Developer Panel":I})}),(0,n.jsxs)("div",{className:i().right,children:[(null==d?void 0:d.user)&&(0,n.jsx)("div",{className:i().avatarWrapper,onClick:()=>h(e=>!e),children:(0,n.jsx)("img",{src:d.user.image,alt:"Profile",className:i().avatar})}),(null==d?void 0:d.user)&&p&&(0,n.jsxs)("div",{className:i().dropdown,ref:S,children:[(0,n.jsxs)("div",{className:i().userInfoDropdown,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User:"})," ",(null==b?void 0:b.username)||d.user.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Plan:"})," ",(null==A?void 0:A.name)||(null==b?void 0:b.plan)||"Free"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Max Forms:"})," ",null!==(a=null==A?void 0:A.max_forms)&&void 0!==a?a:"N/A"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Max Questions:"})," ",null!==(l=null==A?void 0:A.max_questions)&&void 0!==l?l:"N/A"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Time Remaining:"}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:T||"N/A"})]})]}),(0,n.jsx)("a",{href:"https://discord.gg/svHdVh2Bff",target:"_blank",rel:"noopener noreferrer",className:i().devButton,style:{textAlign:"center"},children:"\uD83D\uDD17 Join Support Server"}),"/servers"!==v&&(0,n.jsx)("button",{className:i().devButton,onClick:()=>c.push("/servers"),children:"\uD83D\uDD01 Switch Servers"}),f&&(0,n.jsx)("button",{className:i().devButton,onClick:()=>c.push("/developer/dashboard"),children:"\uD83D\uDEE0 Developer Panel"}),(0,n.jsx)("button",{className:i().logout,onClick:()=>(0,o.signOut)({callbackUrl:"/home"}),children:"\uD83D\uDCD5 Log out"})]})]})]})}},83041:function(e){e.exports={topbar:"Topbar_topbar__V0QGl",right:"Topbar_right__Jj2ao",logoArea:"Topbar_logoArea__forZL",logoImage:"Topbar_logoImage__LJuRd",brand:"Topbar_brand__3hSuU",avatarWrapper:"Topbar_avatarWrapper__5Bf2P",avatar:"Topbar_avatar__Eq_S3",dropdown:"Topbar_dropdown__HJUG8",fadeIn:"Topbar_fadeIn__o0Bh1",name:"Topbar_name__eFLUk",logout:"Topbar_logout__u1BV7",devButton:"Topbar_devButton__28Bss",centerText:"Topbar_centerText__7McvY",guildName:"Topbar_guildName__av6yP",userInfoDropdown:"Topbar_userInfoDropdown__dVogq"}}}]);