<%- include('partials/navbar') %>

<div class="dev-wrapper">
  <aside class="dev-sidebar">
    <h2>ğŸ› ï¸ Dev Panel</h2>
    <ul>
      <li><a href="/developer/dashboard">ğŸ“Š Dashboard</a></li>
      <li><a href="/developer/servers">ğŸŒ Servers</a></li>
      <li><a href="/developer/users">ğŸ‘¥ Users</a></li>
      <li><a href="/developer/dev-users">ğŸ”‘ Dev Users</a></li>
      <li><a href="/dashboard">â†©ï¸ Back to User Panel</a></li>
    </ul>
  </aside>

  <main class="dev-content">
    <h1>ğŸ“Š Developer Dashboard</h1>

    <div class="dev-grid">
        <div class="dev-card">
            <h3>Total Servers</h3>
            <canvas id="serverChart" width="300" height="300"></canvas>
          </div>   
          <div id="serverData" data-count="<%= guildCount %>"></div>       

      <div class="dev-card">
        <h3>User Plans</h3>
        <canvas id="planChart" width="300" height="300"></canvas>
      </div>
    </div>
  </main>
</div>

<div id="planData" 
     data-labels='<%= JSON.stringify(plans.map(p => p.plan)) %>' 
     data-counts='<%= JSON.stringify(plans.map(p => p.count)) %>'>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ğŸ”¹ User Plan Chart
    const planEl = document.getElementById('planData');
    const labels = JSON.parse(planEl.getAttribute('data-labels'));
    const counts = JSON.parse(planEl.getAttribute('data-counts'));

    const planData = {
      labels,
      datasets: [{
        label: 'Users by Plan',
        data: counts,
        backgroundColor: ['#3498db', '#2ecc71', '#e74c3c', '#9b59b6'],
        hoverOffset: 6,
        cutout: '60%'
      }]
    };

    const planCtx = document.getElementById('planChart').getContext('2d');
    new Chart(planCtx, {
      type: 'doughnut',
      data: planData,
      options: {
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#ffffff'
            }
          }
        }
      }
    });

    // ğŸ”¸ Total Servers Chart
    const serverEl = document.getElementById('serverData');
    const serverCount = parseInt(serverEl.getAttribute('data-count')) || 0;

    const serverData = {
      labels: ['Servers', ''],
      datasets: [{
        data: [serverCount, 0],
        backgroundColor: ['#9b59b6', '#2c2c2c'],
        hoverOffset: 6,
        cutout: '70%'
      }]
    };

    const serverCtx = document.getElementById('serverChart').getContext('2d');
    new Chart(serverCtx, {
      type: 'doughnut',
      data: serverData,
      options: {
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
  });
</script>
